# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

### Ответ:
Под описанные требования на мой взгляд подойдёт GitLab CI (ранее выполнялась на нем домашняя работа).

| Требование по ТЗ             | Комментарии                                                                                                                                                                                                                                                  |
|------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Облачное решение             | * Есть готовое решение в Яндекс облаке (Managed Service for GitLab + Runner).<br> * Так же есть возможность поднять инфраструктуру на "своём железе".<br> * Воспользоваться платной подпиской на GitLab.com, но в данный момент есть сложности с её оплатой. |
| Система контроля версий Git  | GitLab - изначально и создавался как инструмент версионирования, поэтому данный функицонал доступен уже "из коробки"                                                                                                                                         |
| Репозиторий на каждый сервис | Gitlab позволяет это делать. При этом на каждый сервис можно выдать ограниченные права, что удобно если разработкой занимаются несколько команд.                                                                                                             |
| Запуск сборки                | Поддерживаются разнообразные сценарии.                                                                                                                                                                                                                       |
| Возможности конфигурирования | Возможно установить разные настройки на проекты (задать переменные, настройки и скрипты сборок).                                                                                                                                                             |
| Дополнительные возможности   | Имеет встроенный Registry, в котором могут храниться артефакты и собственные образы для использования.                                                                                                                                                       |

---
## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.
### Ответ:
* **ELK Stack:**
    * elasticsearch - это одна из самых популярных поисковых систем в области Big Data, масштабируемое нереляционное хранилище данных с открытым исходным кодом, аналитическая NoSQL-СУБД с широким набором функций полнотекстового поиска.
    * logstash - сборщик данных из различных источников, может преобразовывать их и отправлять в нужное место назначения.
    * Kibana - это инструмент визуализации и изучения данных для просмотра журналов и событий. 
    * FileBeat – агент на серверах для отправки различных типов оперативных данных в ES.

* **TICK:**
    * Telegraf - сбор последовательных данных из различных источников, включая устройства IoT.
    * InfluxDB - высокопроизводительное и эффективное хранилище данных для обработки больших объемов данных временных рядов.
    * Chronograf - визуализация данных InfluxDB в реальном времени. 
    * Kapacitor - мониторинг и оповещение на основе представлений данных InfluxDB и аномалий, содержащихся в этих представлениях.

---
## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

### Ответ:
Под данные требования подходят 2 достаточно известных решения - это Zabbix (all in one) и Prometheus + Grafana.

| Название             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Zabbix               | это ПО с открытым исходным кодом с бэкэндом C и интерфейсом PHP. Имеет распределенную архитектуру сервера и клиента, поэтому на каждой стороне клиента необходимо установить агент Zabbix для сбора и отправки данных на сервер. Если необходимо использовать MySQL, MariaDB, PostgreSQL, SQLite, Oracle или IBM DB2 для хранения данных, то этот инструмент хорошо подойдет для мониторинга. Есть встроенная функция оповещения, позволяющая управлять событиями различными способами: отправка сообщений, выполнение удаленных команд и т.д. | 
| Prometheus + Grafana | у Prometheus открытый исходный код, а сам продукт бесплатен. Он считается **более современным инструментом**, который используют, когда требуется решение для мониторинга базы данных с временными показателями и нужно долговременное хранилище для метрик. Можно использовать готовые Dashboards Grafana для визуализации данных, настраивать кастомные и многое другое.Также Prometheus имеет поддержку от стороннего Node Exporter, который может помочь Prometheus извлечь различные аппаратные и связанные с ядром метрики.              |

