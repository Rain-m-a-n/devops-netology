# Домашнее задание к занятию 13 «Введение в мониторинг»

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. 
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?  
     ### Ответ: 
   |   Метрика    | Обоснование                                                        |
   |:------------:|:-------------------------------------------------------------------|
   |     CPU      | Мониторинг нагрузки на CPU                                         | 
   |     RAM      | Контроль свободных ресурсов памяти и потребления                   |
   | HTTP/Request | Мониторинг общего количества запросов к системе                    |
   | HTTP/Answers | Мониторинг от ответов(400/500) для определения доступности ресурса |
   |     HDD      | Мониторинг свободного места на диске + (скорость чтение/запись)    |
   |     LAN      | Мониторинг сетевой нагрузки для анализа и планирования сети        |
   |    Inodes    | Мониторинг свободных дескрипторов, дабы избежать остановки сервиса |
   |   Service    | Мониторинг службы веб сервиса на предмет доступности               |

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?  
      ### Ответ:
   | RAM    | Объем установленной и доступной оперативной памяти для запуска приложений. Отсутствие, либо малый объем свободной RAM может приводить к "зависанияю" программ и "задумчивости" системы в целом |
   |--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | inodes | Максималькое количество файлов в системе, которое может быть записано на диск, если свободных inode не будет, в систему ничгео не получится записать? даже рпи наличии места на диске          |
   | CPUla | Средняя загрузка процессора, для обработки запросов, чем выше показатель - тем хуже для системы в целом                                                                                        |
   ###
    Для определения качества обслуживания нужно оговорить и принять допустимые значения SLO.
###
3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?  
     ### Ответ:
    Можно написть скрипт, который будет собирать данные из папки: /proc/ и вылкдаывать их в общедоступное место для разработчиков.
    Для поддержания данных в актуальном состоянии настраиваем расписание через Сron.
4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов.   
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?  
     ### Ответ:
    В формуле учитываются только 200 ответы, которые деляться на  общее количество запросов. 
    Для правильного расчета нужно изменить формулу: (summ_1xx_requests+summ_2xx_requests+summ_3xx_requests)/sum_all_requests.
5. Опишите основные плюсы и минусы pull и push систем мониторинга.  

   | Система мониторинга | Плюсы                                                                                                                                                       | Минусы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   |---------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | PULL                | Легче контролировать подлинность данных <br/> Можно настроить единый proxy server до всех агентов с TLS <br/> Упрощённая отладка получения данных с агентов | Задержка в получении данных: так как данные собираются только при запросе, может возникать некоторая задержка в получении актуальной информации <br/> Нагрузка на сеть: при активном использовании pull системы может возникать большая нагрузка на сеть при каждом запросе на получение данных. <br/> Ограниченная возможность мониторинга в режиме реального времени: pull система может не обеспечивать возможность мониторинга в режиме реального времени из-за задержки в получении данных. |
   | PUSH                | Упрощение репликации данных в разные системы мониторинга или их резервные копии <br/> более гибкая настройка отправки пакетов данных с метриками <br/> UDP — это менее затратный способ передачи данных, из-за чего может возрасти производительность сбора метрик     | Высокая нагрузка на ресурсы: push системы активно передают данные в режиме реального времени, что может приводить к высокой нагрузке на ресурсы и сеть. <br/> Сложность настройки и интеграции: push системы требуют более сложной настройки и интеграции с приложениями и устройствами. <br/> Потенциальные проблемы безопасности: так как push системы активно передают данные, может возникать потенциальная угроза безопасности при передаче конфиденциальной информации.|

7. Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

   | Наименование     | Тип системы  |
   |------------------|--------------|
   | Prometheus       | Pull         |
   | TICK             | Push         |
   | Zabbix           | Pull & Push  |
   | VictoriaMetrics  | Pull & Push  |
   | Nagios           | Pull         |
   
#
7. Склонируйте себе [репозиторий](https://github.com/influxdata/sandbox/tree/master) и запустите TICK-стэк,
   используя технологии docker и docker-compose.

В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (`http://localhost:8888`).

   ![res](https://github.com/Rain-m-a-n/devops-netology/blob/master/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B%20%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%B0/Home_Work_(10.1)/pics/chronograf.png)

P.S.: если при запуске некоторые контейнеры будут падать с ошибкой - проставьте им режим `Z`, например
`./data:/var/lib:Z`
#
8. Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer.

   - Нажмите на кнопку Add a query
   - Изучите вывод интерфейса и выберите БД telegraf.autogen
   - В `measurments` выберите cpu->host->telegraf-getting-started, а в `fields` выберите usage_system. Внизу появится график утилизации cpu.
   - Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. Поэкспериментируйте с запросом, попробуйте изменить группировку и интервал наблюдений.
   ![res](https://github.com/Rain-m-a-n/devops-netology/blob/master/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B%20%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%B0/Home_Work_(10.1)/pics/chronograf.png)
Для выполнения задания приведите скриншот с отображением метрик утилизации cpu из веб-интерфейса.
#
9. Изучите список [telegraf inputs](https://github.com/influxdata/telegraf/tree/master/plugins/inputs).
   Добавьте в конфигурацию telegraf следующий плагин - [docker](https://github.com/influxdata/telegraf/tree/master/plugins/inputs/docker):
```
[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
```

Дополнительно вам может потребоваться донастройка контейнера telegraf в `docker-compose.yml` дополнительного volume и
режима privileged:
```
  telegraf:
    image: telegraf:1.4.0
    privileged: true
    volumes:
      - ./etc/telegraf.conf:/etc/telegraf/telegraf.conf:Z
      - /var/run/docker.sock:/var/run/docker.sock:Z
    links:
      - influxdb
    ports:
      - "8092:8092/udp"
      - "8094:8094"
      - "8125:8125/udp"
```

После настройке перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список `measurments` в
веб-интерфейсе базы telegraf.autogen . Там должны появиться метрики, связанные с docker.

Факультативно можете изучить какие метрики собирает telegraf после выполнения данного задания.    